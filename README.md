(正規)パターン言語
===

パターンとは、以下のpattern として定められるもの。

```
Sigma: alphabet
X: vars

pattern = (Sigma or X)+
```

ここで、同じ変数は一度しか登場しないものを 正規パターンという。

パターン p に出現する変数に、空も含む、任意の文字列を代入してできる文字列の集合を、
パターン p が生成する言語 L(p) という。

パターン集合 `Pi = {p1, p2 ..}`
が生成する言語を
```
L(Pi) = L(p1) or L(p2) or ...
```
と定める.

パターン p にある代入を行うことで パターン q が生成されるような関係にあるときを、
```
p -> q
```
と書く。

> 嘘です。
> `q \preceq p`
> と書きます。
> 半順序

p is genelization of q と読む。

文字列 s, t に対して
```
p -> s
p -> t
```
というp を s,t の共通汎化と呼び、
s,tについての、pとは異なる任意の共通汎化 p' に対して

```
p' -> p
p -/> p' (not)
```

のとき、pを極小であるという。

例えば、
"dog and cat",
"cat and dog"
の共通汎化として

"X and Y", "X Y" "X"
がありえる

```
"X Y" -> "X and Y"
"X" -> "X and Y"
"X and Y" -/> "X Y"
"X and Y" -/> "X"
```

なので、"X and Y" がそれ。

lcs.coffee
---

二つの文字列から、最長の共通部分文字列を見つける。
ここで部分文字列はもとの文字列において連続であること。

mcp.coffee
---

二つの文字列から、極小の共有汎化 (minimum common generalization) を探す。
最長共有部分文字列を探してーってやってるけど正しい保証があんまない。

extract-pattern.coffee
---

文字列集合 TPとTQから、なるべくTP を生成して、なるべく TQ を生成しないような
パターン集合 Pi を返す。

score.coffee
---

一つの文 d と、Pi, TP, TQ を受け取って、
Pi の内 d を生成するようなパターンの集合のうち、
TPを生成する数から、TQを生成する数を引き算して、
dがTPに属しているというスコアを返す。

index.coffee
---

文書集合 TP, TQ, U を受け取って
UがP, Q どちらに属するか
{P, Neutral, Q}
のスコアで返す

author.coffee
===

作者別に、小説にはパターンがあるのではないか。

doc/
---

### 太宰治
```
http://www.aozora.gr.jp/cards/000035/card275.html > doc/joseito.txt
http://www.aozora.gr.jp/cards/000035/card42945.html > doc/dasgemeine.txt
http://www.aozora.gr.jp/cards/000035/card2253.html > doc/viyon.txt
```

### 島崎藤村
```
http://www.aozora.gr.jp/cards/000158/card1511.html > doc/arashi.txt
http://www.aozora.gr.jp/cards/000158/card2949.html > doc/asameshi.txt
http://www.aozora.gr.jp/cards/000158/card47172.html > doc/shokudo.txt
```

|  作品          | 文の数 |
|:---------------|-------:|
| 女生徒         |    961 |
| ダス・ゲマイネ |    839 |
| ヴィヨンの妻   |    494 |
| 嵐             |   1264 |
| 朝飯           |    132 |
| 食堂           |    447 |

学習のもとはある程度多くて、
できれば両者バランスを取った方がいいだろう。

```
TP = ヴィヨンの妻
TQ = 食堂
```

|  作品          |  P  |  N  |  Q  | P <> Q |
|:---------------|----:|----:|----:|:------:|
| 女生徒         | 178 | 708 |  75 |   P    |
| ダス・ゲマイネ | 215 | 537 |  87 |   P    |
| ヴィヨンの妻   | 261 | 224 |   9 |   P    |
| 嵐             | 114 | 962 | 188 |   Q    |
| 朝飯           |  12 |  78 |  42 |   Q    |
| 食堂           |  81 | 270 |  96 |   Q    |

自分で自分自身を診断してるのは、
当然ながら正しく判定されていて当然。
ある種のテストのつもりで。

で、上の表は上手く行ってるのだけれど、
「あんまり上手くはいかない」ってことを
本当は書きたかった。

というのも、学習に使う作品の選び方によっては、
随分結果が変わるから。


```
TP = 女生徒
TQ = 嵐
```

|  作品          |  P  |  N  |  Q  | P <> Q |
|:---------------|----:|----:|----:|:------:|
| 女生徒         | 356 | 444 | 161 | P |
| ダス・ゲマイネ | 43 | 507 | 289 | Q |
| ヴィヨンの妻   | 139 | 154 | 201 | Q |
| 嵐             | 12 | 226 | 1026 | Q |
| 朝飯           | 24 | 60 | 48 | Q |
| 食堂           | 81 | 161 | 205 | Q |

たんじゅんに学習は多いほうがいいだろう、としたら、
全部、島崎藤村と判定した。

一番文が多い嵐を使ったから？

```
TP = 女生徒
TQ = 嵐[0 ... 500]
```

女生徒 961 に対して、嵐 500.


|  作品          |  P  |  N  |  Q  | P <> Q |
|:---------------|----:|----:|----:|:------:|
| 女生徒         | 441 | 438 |  82 | P |
| ダス・ゲマイネ | 101 | 472 | 266 | Q |
| ヴィヨンの妻   |  95 | 340 |  59 | P |
| 嵐             | 159 | 454 | 651 | Q |
| 朝飯           |  25 |  79 |  28 | Q |
| 食堂           | 326 |  80 |  41 | P |

勝率 66.67% (学習元データも含むけど)
多ければいいわけでない、ってのが不思議だ。

ちなみに、女生徒も500に限定すると、食堂を正しく Q と判定して、 勝率。7/8 になった。

